<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>redirecting...</title>
</head>
<body>
<p>フォームへ移動しています…</p>
<p><a id="fallback" href="#">開かない場合はこちらをクリック</a></p>
<script>
(function(){
  var rid = Math.random().toString(36).substring(2,7);  // 5文字ランダムID
  var ua  = navigator.userAgent || "";
  var gasApiUrl = "https://script.google.com/a/macros/ous.ac.jp/s/AKfycbxAtPcHlt1xQUDO2uHwMahmKb98VdCc0dNj_bmflurnyeswEb-mSLzwwyGdrfU3J7k/exec?log=1"; // ←置き換え
  var formBase  = "https://docs.google.com/forms/d/e/1FAIpQLScG3joWGpGkjGHGJ-Gna84CPxI2xg36M1gWErtxv6WBkuZCaQ/viewform?usp=pp_url"; // ←置き換え
  var entryKey  = "entry.1415853317"; // ←置き換え

  function rid5(){
    var s = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
    var r = "";
    for (var i=0;i<5;i++) r += s.charAt(Math.floor(Math.random()*s.length));
    return r;
  }

  var rid = rid5();
  var ua  = navigator.userAgent || "";
  var dest = FORM_BASE + "&" + ENTRY_KEY + "=" + encodeURIComponent(rid);
  document.getElementById("fallback").href = dest;

  // 1) sendBeacon (POST)
  try {
    var ok = navigator.sendBeacon(
      GAS + "?log=1",
      new Blob([JSON.stringify({rid: rid, ua: ua})], {type:"text/plain"})
    );
  } catch(e){}

  // 2) 画像GETフォールバック（CORS不要）
  var img = new Image();
  img.src = GAS + "?log=1&rid=" + encodeURIComponent(rid) + "&ua=" + encodeURIComponent(ua);

  // 0.3秒後に通常遷移
  setTimeout(function(){ window.location.replace(dest); }, 300);
})();
</script>
</body>
</html>
